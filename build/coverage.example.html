<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-spritesmith/spritesmith/src/smith.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-spritesmith">npmtest-spritesmith (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-spritesmith/spritesmith/src/smith.js</span></h1>
    <h2>
        
        Statements: <span class="metric">11.22% <small>(11 / 98)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 34)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 13)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">11.22% <small>(11 / 98)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-spritesmith/spritesmith/src/</a> &#187; smith.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// Load in dependencies
var concat = require('concat-stream');
var Layout = require('layout');
var semver = require('semver');
var through2 = require('through2');
&nbsp;
// Specify defaults
var engineDefault = 'pixelsmith';
var algorithmDefault = 'binary-tree';
var SPEC_VERSION_RANGE = '&gt;=2.0.0 &lt;3.0.0';
&nbsp;
// Define our spritesmith constructor
<span class="fstat-no" title="function not covered" >function Spritesmith(params) {</span>
  // Process our parameters
<span class="cstat-no" title="statement not covered" >  params = params || {};</span>
<span class="cstat-no" title="statement not covered" >  var engineName = params.engine || engineDefault;</span>
<span class="cstat-no" title="statement not covered" >  var Engine = engineName;</span>
&nbsp;
  // If the engine is a `require` path, attempt to load it
<span class="cstat-no" title="statement not covered" >  if (typeof engineName === 'string') {</span>
    // Attempt to resolve the engine to verify it is installed at all
<span class="cstat-no" title="statement not covered" >    try {</span>
<span class="cstat-no" title="statement not covered" >      require.resolve(engineName);</span>
    } catch (err) {
<span class="cstat-no" title="statement not covered" >      console.error('Attempted to find spritesmith engine "' + engineName + '" but could not.');</span>
<span class="cstat-no" title="statement not covered" >      console.error('Please verify you have installed "' + engineName + '" and saved it to your `package.json`');</span>
<span class="cstat-no" title="statement not covered" >      console.error('');</span>
<span class="cstat-no" title="statement not covered" >      console.error('    npm install ' + engineName + ' --save-dev');</span>
<span class="cstat-no" title="statement not covered" >      console.error('');</span>
<span class="cstat-no" title="statement not covered" >      throw err;</span>
    }
&nbsp;
    // Attempt to load the engine
<span class="cstat-no" title="statement not covered" >    try {</span>
<span class="cstat-no" title="statement not covered" >      Engine = require(engineName);</span>
<span class="cstat-no" title="statement not covered" >      if (typeof Engine !== 'function') {</span>
<span class="cstat-no" title="statement not covered" >        Engine = Engine.default;</span>
      }
    } catch (err) {
<span class="cstat-no" title="statement not covered" >      console.error('Attempted to load spritesmith engine "' + engineName + '" but could not.');</span>
<span class="cstat-no" title="statement not covered" >      console.error('Please verify you have installed its dependencies. Documentation should be available at ');</span>
<span class="cstat-no" title="statement not covered" >      console.error('');</span>
      // TODO: Consider using pkg.homepage and pkg.repository
<span class="cstat-no" title="statement not covered" >      console.error('    https://npm.im/' + encodeURIComponent(engineName));</span>
<span class="cstat-no" title="statement not covered" >      console.error('');</span>
<span class="cstat-no" title="statement not covered" >      throw err;</span>
    }
  }
&nbsp;
  // Verify we are on a matching `specVersion`
<span class="cstat-no" title="statement not covered" >  if (!semver.satisfies(Engine.specVersion, SPEC_VERSION_RANGE)) {</span>
<span class="cstat-no" title="statement not covered" >    throw new Error('Expected `engine` to have `specVersion` within "' + SPEC_VERSION_RANGE + '" ' +</span>
      'but it was "' + Engine.specVersion + '". Please verify you are on the latest version of your engine: ' +
      '`npm install my-engine@latest`');
  }
&nbsp;
  // Create and save our engine for later
<span class="cstat-no" title="statement not covered" >  this.engine = new Engine(params.engineOpts || {});</span>
}
// Gist of params: {src: files, engine: 'pixelsmith', algorithm: 'binary-tree'}
// Gist of result: image: buffer, coordinates: {filepath: {x, y, width, height}}, properties: {width, height}
Spritesmith.run = <span class="fstat-no" title="function not covered" >function (params, callback) {</span>
  // Create a new spritesmith with our parameters
<span class="cstat-no" title="statement not covered" >  var spritesmith = new Spritesmith(params);</span>
&nbsp;
  // In an async fashion, create our images
<span class="cstat-no" title="statement not covered" >  spritesmith.createImages(params.src, <span class="fstat-no" title="function not covered" >function handleImages (err, images) {</span></span>
    // If there was an error, callback with it
<span class="cstat-no" title="statement not covered" >    if (err) {</span>
<span class="cstat-no" title="statement not covered" >      return callback(err);</span>
    }
&nbsp;
    // Otherwise, process our images, concat our image, and callback
    // DEV: We don't want to risk dropped `data` events due to calling back with a stream
<span class="cstat-no" title="statement not covered" >    var spriteData = spritesmith.processImages(images, params);</span>
&nbsp;
    // If an error occurs on the image, then callback with it
<span class="cstat-no" title="statement not covered" >    spriteData.image.on('error', callback);</span>
&nbsp;
    // Concatenate our image into a buffer
<span class="cstat-no" title="statement not covered" >    spriteData.image.pipe(concat({encoding: 'buffer'}, <span class="fstat-no" title="function not covered" >function handleImage (buff) {</span></span>
      // Callback with all our info
<span class="cstat-no" title="statement not covered" >      callback(null, {</span>
        coordinates: spriteData.coordinates,
        properties: spriteData.properties,
        image: buff
      });
    }));
  });
};
Spritesmith.prototype = {
  createImages: <span class="fstat-no" title="function not covered" >function (files, callback) {</span>
    // Forward image creation to our engine
<span class="cstat-no" title="statement not covered" >    this.engine.createImages(files, <span class="fstat-no" title="function not covered" >function handleImags (err, images) {</span></span>
      // If there was an error, callback with it
<span class="cstat-no" title="statement not covered" >      if (err) {</span>
<span class="cstat-no" title="statement not covered" >        return callback(err);</span>
      }
&nbsp;
      // Otherwise, iterate over the images and save their paths (required for coordinates)
<span class="cstat-no" title="statement not covered" >      images.forEach(<span class="fstat-no" title="function not covered" >function saveImagePath (img, i) {</span></span>
        // DEV: We don't use `Vinyl.isVinyl` since that was introduced in Sep 2015
        //   We want some backwards compatibility with older setups
<span class="cstat-no" title="statement not covered" >        var file = files[i];</span>
<span class="cstat-no" title="statement not covered" >        img._filepath = typeof file === 'object' ? file.path : file;</span>
      });
&nbsp;
      // Callback with our images
<span class="cstat-no" title="statement not covered" >      callback(null, images);</span>
    });
  },
  processImages: <span class="fstat-no" title="function not covered" >function (images, options) {</span>
    // Set up our algorithm/layout placement and export configuration
<span class="cstat-no" title="statement not covered" >    options = options || {};</span>
<span class="cstat-no" title="statement not covered" >    var algorithmName = options.algorithm || algorithmDefault;</span>
<span class="cstat-no" title="statement not covered" >    var layer = new Layout(algorithmName, options.algorithmOpts);</span>
<span class="cstat-no" title="statement not covered" >    var padding = options.padding || 0;</span>
<span class="cstat-no" title="statement not covered" >    var exportOpts = options.exportOpts || {};</span>
<span class="cstat-no" title="statement not covered" >    var packedObj;</span>
&nbsp;
    // Generate stream and info for returning
<span class="cstat-no" title="statement not covered" >    var imageStream = through2();</span>
<span class="cstat-no" title="statement not covered" >    var retObj = {image: imageStream};</span>
&nbsp;
    // Add our images to our canvas (dry run)
<span class="cstat-no" title="statement not covered" >    images.forEach(<span class="fstat-no" title="function not covered" >function (img) {</span></span>
      // Save the non-padded properties as meta data
<span class="cstat-no" title="statement not covered" >      var width = img.width;</span>
<span class="cstat-no" title="statement not covered" >      var height = img.height;</span>
<span class="cstat-no" title="statement not covered" >      var meta = {img: img, actualWidth: width, actualHeight: height};</span>
&nbsp;
      // Add the item with padding to our layer
<span class="cstat-no" title="statement not covered" >      layer.addItem({</span>
        width: width + padding,
        height: height + padding,
        meta: meta
      });
    });
&nbsp;
    // Then, output the coordinates
    // Export and saved packedObj for later
<span class="cstat-no" title="statement not covered" >    packedObj = layer['export']();</span>
&nbsp;
    // Extract the coordinates
<span class="cstat-no" title="statement not covered" >    var coordinates = {};</span>
<span class="cstat-no" title="statement not covered" >    var packedItems = packedObj.items;</span>
<span class="cstat-no" title="statement not covered" >    packedItems.forEach(<span class="fstat-no" title="function not covered" >function (item) {</span></span>
<span class="cstat-no" title="statement not covered" >      var meta = item.meta;</span>
<span class="cstat-no" title="statement not covered" >      var img = meta.img;</span>
<span class="cstat-no" title="statement not covered" >      var name = img._filepath;</span>
<span class="cstat-no" title="statement not covered" >      coordinates[name] = {</span>
        x: item.x,
        y: item.y,
        width: meta.actualWidth,
        height: meta.actualHeight
      };
    });
&nbsp;
    // Save the coordinates
<span class="cstat-no" title="statement not covered" >    retObj.coordinates = coordinates;</span>
&nbsp;
    // Then, generate a canvas
    // Grab and fallback the width/height
<span class="cstat-no" title="statement not covered" >    var width = Math.max(packedObj.width || 0, 0);</span>
<span class="cstat-no" title="statement not covered" >    var height = Math.max(packedObj.height || 0, 0);</span>
&nbsp;
    // If there are items
<span class="cstat-no" title="statement not covered" >    var itemsExist = packedObj.items.length;</span>
<span class="cstat-no" title="statement not covered" >    if (itemsExist) {</span>
      // Remove the last item's padding
<span class="cstat-no" title="statement not covered" >      width -= padding;</span>
<span class="cstat-no" title="statement not covered" >      height -= padding;</span>
    }
&nbsp;
    // Export the total width and height of the generated canvas
<span class="cstat-no" title="statement not covered" >    retObj.properties = {</span>
      width: width,
      height: height
    };
&nbsp;
    // After we return the stream and info
<span class="cstat-no" title="statement not covered" >    var that = this;</span>
<span class="cstat-no" title="statement not covered" >    process.nextTick(<span class="fstat-no" title="function not covered" >function handleNextTick () {</span></span>
      // If there are no items, return with an empty stream
<span class="cstat-no" title="statement not covered" >      var canvas;</span>
<span class="cstat-no" title="statement not covered" >      if (!itemsExist) {</span>
<span class="cstat-no" title="statement not covered" >        imageStream.push(null);</span>
<span class="cstat-no" title="statement not covered" >        return;</span>
      // Otherwise, generate and export our canvas
      } else {
        // Crete our canvas
<span class="cstat-no" title="statement not covered" >        canvas = that.engine.createCanvas(width, height);</span>
&nbsp;
        // Add the images onto canvas
<span class="cstat-no" title="statement not covered" >        try {</span>
<span class="cstat-no" title="statement not covered" >          packedObj.items.forEach(<span class="fstat-no" title="function not covered" >function addImage (item) {</span></span>
<span class="cstat-no" title="statement not covered" >            var img = item.meta.img;</span>
<span class="cstat-no" title="statement not covered" >            canvas.addImage(img, item.x, item.y);</span>
          });
        } catch (err) {
<span class="cstat-no" title="statement not covered" >          imageStream.emit('error', err);</span>
<span class="cstat-no" title="statement not covered" >          return;</span>
        }
&nbsp;
        // Export our canvas
<span class="cstat-no" title="statement not covered" >        var exportStream = canvas['export'](exportOpts);</span>
<span class="cstat-no" title="statement not covered" >        exportStream.on('error', <span class="fstat-no" title="function not covered" >function forwardError (err) {</span></span>
<span class="cstat-no" title="statement not covered" >          imageStream.emit('error', err);</span>
        });
<span class="cstat-no" title="statement not covered" >        exportStream.pipe(imageStream);</span>
      }
    });
&nbsp;
    // Return our info
<span class="cstat-no" title="statement not covered" >    return retObj;</span>
  }
};
&nbsp;
// Export Spritesmith
module.exports = Spritesmith;
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Sat Apr 15 2017 20:06:34 GMT+0000 (UTC)</div>
</div>
</body>
</html>
